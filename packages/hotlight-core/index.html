<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Svelte + TS + Vite App</title>
</head>

<body>
  <hotlight-modal id="hotlight"></hotlight-modal>

  <h2>Hotkeys</h2>
  <p>Hit <kbd style="background: rgba(0,0,0,10%); color: black; padding: 2px; border-radius: 4px;">f</kbd> to view keyboard short cuts.</p>
  <h3>Button</h3>
  <hotlight-hotkey key="b">
    <button onclick="alert('button')">alert('button')</button>
  </hotlight-hotkey>

  <h3>Input</h3>
  <hotlight-hotkey key="s">
    <input type="search" placeholder="Search..." />
  </hotlight-hotkey>

  <h3>Textarea</h3>
  <hotlight-hotkey key="t">
    <textarea placeholder="Write message..."></textarea>
  </hotlight-hotkey>

  <h3>Link</h3>
  <hotlight-hotkey key="a">
    <a
      href="https://jonas.arnklint.com"
      target="_blank"
    >
      My website
    </a>
  </hotlight-hotkey>

  <h3>Content editable</h3>
  <hotlight-hotkey key="c">
    <div contenteditable="true">this is editable</div>
  </hotlight-hotkey>

  <h3>Auto mode - enabling <i>input</i>, <i>textarea</i>, <i>button</i>, <i>a</i> automatically</h3>
  <hotlight-hotkeys mode="auto">
    <button onclick="alert('button')">button</button>
    <input type="search" placeholder="Search..." />
    <a href="https://jonas.arnklint.com" target="_blank">My website</a>
    <textarea></textarea>
  </hotlight-hotkeys>

  <div id="app"></div>
  <script type="module" src="/src/main.ts"></script>
  <script>
    const actions = [
      { title: "Home", trigger: "/" },
      { title: "Homer", trigger: "/" },
      { title: "Homer bart", trigger: "/" },
      { title: "Homer bart lisa", trigger: "/" },
      { title: "Homer bart lisa maggie", trigger: "/" },
      { title: "Homer bart lisa maggie simpson", trigger: "/" },
      { title: "About", trigger: () => "/about" }
    ]
    const source = () => {
      return actions;
    }
    const remoteActions = [
      { title: "Installing Hotlight", trigger: "/" },
      { title: "Getting started", trigger: () => "/" },
      { title: "Hotlight React", trigger: () => "/" },
      { title: "Hotlight Svelte", trigger: () => "/" },
      { title: "Go to a website", trigger: () => "https://jonas.arnklint.com", preview: `<div style="background: red; color: white;">My homepage</div>` },
      { title: "Go to another website", trigger: () => "https://hotlight.dev" },
      { title: "Reload Window", trigger: () => location.reload() },
      { title: "Close Hotlight", trigger: ({ close }) => close() },
      { title: "Slow trigger", trigger: async () => await new Promise((resolve) => setTimeout(() => resolve("#slow"), 1000)) },
      { title: "fast trigger", trigger: () => "#fast" },
      { title: "Clear Hotlight", trigger: ({ clear }) => clear() },
      {
        title: "New Contact",
        alias: "Add Contact",// "Create Contact"],
        trigger: async ({ arg, preview, close }) => {
          const name = await arg("Name");
          console.log("received name", name);
          const email = await arg("Email");
          console.log("received email", email);
          const phone = await arg("Phone");
          console.log("received phone", phone);
          preview(`
        <div style="background-color: red">New contact created: ${name}, ${email}, ${phone}</div>
      `)
          location.hash = `#${[name, email, phone]}`;
          //close();
        }
      },
    ]

    const remote = async (query) => {
      return await new Promise((resolve) => {
        setTimeout(() => {
          return resolve(remoteActions);
        }, 250 * Math.random());
      });
    }

    const source3 = async (query) => {
      const res = await fetch("https://31dgeh4x4m.execute-api.eu-west-1.amazonaws.com/hello?query=" + query)

      if (res.ok) {
        const { message } = await res.json();
        return message.hits.map(hit => ({
          title: "" + new Date().getTime() + hit.id,
          trigger: "/"
        }));
      } else {
        return [];
      }
    }

    const sources = [source, source3, remote];

    window.customElements.whenDefined('hotlight-modal').then(() => {
      const hl = document.getElementById("hotlight");
      hl.sources(sources);
      //hl.hidden = false;
      //hl.query("contact");

      /*
      setTimeout(() => {
        hl.sources([]);
        console.log("set new sources;");
      }, 5000)

      setTimeout(() => {
        hl.sources([source]);
        console.log("set new sources;", source);
      }, 10000)
      */
    });
  </script>

  <!--
      <p>
        This is my blue stuff
      </p>
      <div style="height: 200vh; background-color: blue;">
        This is my blue stuff
      </div>
    -->
</body>

</html>
